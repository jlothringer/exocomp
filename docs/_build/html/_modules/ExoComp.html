

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>exocomp &mdash; exocomp 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            exocomp
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">exocomp</a></li>
<li class="toctree-l1"><a class="reference external" href="https://jlothringer.github.io/exoplanet_datatable.html">The ExoComp Table</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">exocomp</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">exocomp</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for exocomp</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Fri Jun  6 14:04:20 2025</span>

<span class="sd">@author: jlothringer</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">easychem.easychem</span> <span class="k">as</span> <span class="nn">ec</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span><span class="p">,</span><span class="n">fmin</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="c1">#import emcee</span>

<span class="c1">#Tasks</span>
<span class="c1">#   1) Convert molecular measurements to bulk abundances [mostly done, make version with refractories]</span>
<span class="c1">#        e.g., take log10(H2O)_vmr and convert</span>
<span class="c1">#   2) Convert VMRs to MMRs and vice versa</span>
<span class="c1">#   3) Convert elemental ratios relative to solar to different definitions of solar or stellar [mostly done, add more solar defs]</span>
<span class="c1">#       a) Add stellar abund option</span>
<span class="c1">#   4) Given [M/H], C/O, elemental abund, P, and T, give expected molecular abundances</span>
<span class="c1">#       4.5) And vice-versa - given molecular abundances, P, T, and solar definition, give best-fitting [M/H] &amp; C/O [done, make version with refractories]</span>
<span class="c1">#           -A bit better than just adding up molecules... because you may be missing some.</span>
<span class="c1">#           -So given H2O and CO2, you can get [M/H] and C/O!</span>

<span class="c1">#todo: 1) add refractory to volatile fits [done]</span>
<span class="c1">#2) add stellar [done]</span>
<span class="c1">#3) do some real-world examples [done]</span>
<span class="c1">#4) write up </span>
<span class="c1">#5) make PEP compliant </span>
<span class="c1">#6) look at obs and find pop means </span>
<span class="c1">#7) make table publishable [and add uncertainty to mass and temp] </span>
<span class="c1">#8) Make mcmc version </span>
<span class="c1">#9) make posterior version [done]</span>
<span class="c1">#9) Make version where neither C or O are individually adjusted for C/O, but rather both! preserving metallicity! [done]</span>
<span class="c1">#10) add goodness of fit info... will want to choose between ways to handle C/O and whether adding ref/vol is justified [done]</span>
<span class="c1">#11) enhanced errorbars - upper/lower limits and asymm bars</span>
<span class="c1">#12) create test block/routine</span>
<span class="c1">#13) look at posteriors of W-178b</span>
<span class="c1">#14) The presence of gaseous H2O sets a limit of ref/vol for cloudy atmospheres</span>
<span class="c1">#   -lol if only ref-O enriched a planet atmosphere, we&#39;d only see O in refractory phase (more the most part)</span>

<span class="c1">##Test</span>
<span class="c1">## M/H= 1.0 and C/O = 0.5 at T=1000 and P = 1</span>
<span class="c1">#{&#39;H2O&#39;: -2.193862599311742, &#39;CO&#39;: -2.9951664932143895,&#39;CO2&#39;: -4.957449831706032} for Asplund 09</span>
<span class="c1">#{&#39;H2O&#39;: -2.196454926078874, &#39;CO&#39;: -2.95559683423187, &#39;CO2&#39;: -4.9118293333092335} for Lodders 25</span>

<span class="c1">#Depends on how you change C/O! Esp. when there are other elements setting M/H</span>
<span class="c1">#g = Abund(species_abunds={&#39;H2O&#39;:-2.96,&#39;CH4&#39;:-9.05,&#39;CO2&#39;:-5.81,&#39;K&#39;:-8.07,&#39;Na&#39;:-9.31},species_errs={&#39;H2O&#39;:0.31,&#39;CH4&#39;:2.1,&#39;CO2&#39;:1.31,&#39;K&#39;:0.58,&#39;Na&#39;:1.77}) #W17b</span>
<span class="c1">#g.convert_species_abunds(1271, 5e-3)</span>
<span class="c1">#versus </span>
<span class="c1">#g.convert_species_abunds(1271, 5e-3,adjust_C=False)</span>


<div class="viewcode-block" id="Abund">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund">[docs]</a>
<span class="k">class</span> <span class="nc">Abund</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Top-level class for abundance calculations.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    species_abunds : dict </span>
<span class="sd">        (Optional) Input/output for bulk_abundance calculations. Of form {species:VMR} </span>
<span class="sd">        (e.g., {&#39;H2O&#39;:1e-3})</span>
<span class="sd">        </span>
<span class="sd">    species_errs : dict </span>
<span class="sd">        (Optional) Input/output for bulk_abundance calculations. Of form {species:VMR_err} for symmetric errors (e.g., {&#39;H2O&#39;:1e-4}),  </span>
<span class="sd">        {species:[VMR_low,VMR_high]} for asymetric error bars, or {species:[VMR_0,VMR_1,...]} for posteriors.</span>
<span class="sd">        </span>
<span class="sd">    solar : str</span>
<span class="sd">        (Optional) Which set of solar abundances to use. Default is Lodders25. Possible options listed in</span>
<span class="sd">        self.possible_solars.</span>
<span class="sd">    </span>
<span class="sd">    retrieval : str</span>
<span class="sd">        (Optional) Which retrieval code was used to produce metallicity and C/O constraints. This is used to</span>
<span class="sd">        choose the correct conversion calculation. Defines self.mh_type, self.co_type, and self.solar.</span>
<span class="sd">        Not all retrieval codes are included and you may need a different set up, so you can just define</span>
<span class="sd">        self.mh_type, self.co_type, and self.solar yourself.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    </span>
<span class="sd">    bulk_abunds : dict </span>
<span class="sd">        Where output of fits to species abundances or conversion to different solar compositions is placed.</span>
<span class="sd">        Will be of the format {&#39;O&#39;:8.0} for an O/H ratio of 1e8 parts per trillion (i.e., H = 1e12).</span>
<span class="sd">        </span>
<span class="sd">    bulk_errs : dict </span>
<span class="sd">        (Optional) Where output of fits to species abundances or conversion to different solar compositions is placed. </span>
<span class="sd">        Of form {species:bulk_errs} for symmetric errors (e.g., {&#39;O/H&#39;:0.5}),  </span>
<span class="sd">        {species:[abund_low,abund_high]} for asymetric error bars, or {species:[abund_0,abund_1,...]} for posteriors.</span>
<span class="sd">     </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    possible_solars() : list possible solar compositions</span>
<span class="sd">    define_stellar() : define host star composition to use instead of solar</span>
<span class="sd">    VMR_to_MMR() : convert a dict of volume mixing ratios to mass fraction</span>
<span class="sd">    MMR_to_VMR() : convert a dict of mass fractions to volume mixing ratios</span>
<span class="sd">    convert_bulk_abundance() : given bulk abundance properties, calculate elemental abundances</span>
<span class="sd">    convert_solar()  : convert self.bulk_abundances to another definition of solar</span>
<span class="sd">    convert_species_abunds() : given species abundances, calculate bulk abundances</span>
<span class="sd">    predict_abund() : given bulk abundance properties, calculate species abundances</span>
<span class="sd">    init_ec() : utility function to initialize easyCHEM with proper solar abundances</span>
<span class="sd">    import_masses() : read in molecular masses for MMW calculation </span>
<span class="sd">        (e.g., conversion between VMR and MMR)</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    species_type : VMR or MMR</span>
<span class="sd">    solar_abundances : elemental abundances for given self.solar</span>
<span class="sd">    solar_abundances_orig : solar abundances first defined in class definition</span>
<span class="sd">    possible_solars : list of possible solar compositions</span>
<span class="sd">    best_fit_mh : best-fit metallicity from convert_species_abunds</span>
<span class="sd">    best_fit_co : best-fit C/O from convert_species_abunds</span>
<span class="sd">    best_fit_refvol : best-fit ref/vol from convert_species_abunds</span>
<span class="sd">    best_fit_abund : best-fit species abundances from convert_species_abunds</span>
<span class="sd">    Asplund09 : elemental abundance definitions from Asplund, M., et al. (2009). ARA&amp;A, 47, 481</span>
<span class="sd">    Asplund21 : elemental abundance definitions from Asplund, M., et al. (2021). A&amp;A, 653, A141  </span>
<span class="sd">    Asplund05 : elemental abundance definitions from </span>
<span class="sd">    Lodders10 : elemental abundance definitions from </span>
<span class="sd">    Lodders20 : elemental abundance definitions from Lodders, K. (2020). Space Sci. Rev., 216, 44</span>
<span class="sd">    Caffau11 : elemental abundance definitions from </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Setting up for a bulk abundance calculation with symmetric errors</span>
<span class="sd">    g = Abund(species_abunds={&#39;H2O&#39;:-2.96,&#39;CH4&#39;:-9.05,&#39;CO2&#39;:-5.81,&#39;K&#39;:-8.07,&#39;Na&#39;:-9.31},</span>
<span class="sd">              species_errs={&#39;H2O&#39;:0.31,&#39;CH4&#39;:2.1,&#39;CO2&#39;:1.31,&#39;K&#39;:0.58,&#39;Na&#39;:1.77})</span>
<span class="sd">    </span>
<span class="sd">    Setting up for a bulk abundance calculation with posteriors</span>
<span class="sd">    g = Abund(species_abunds={&#39;H2O&#39;:-2.96,&#39;CH4&#39;:-9.05,&#39;CO2&#39;:-5.81,&#39;K&#39;:-8.07,&#39;Na&#39;:-9.31},</span>
<span class="sd">              species_errs={&#39;H2O&#39;:np.random.normal(-2.96,0.31,100),&#39;CH4&#39;:np.random.normal(-9.05,2.1,100),</span>
<span class="sd">                            &#39;CO2&#39;:np.random.normal(-5.81,1.31,100),</span>
<span class="sd">                            &#39;K&#39;:np.random.normal(-8.07,0.58,100),&#39;Na&#39;:np.random.normal(-9.31,1.77,100)})</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="Abund.__init__">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bulk_abunds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">species_abunds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">bulk_errs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">species_errs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">species_type</span><span class="o">=</span><span class="s1">&#39;VMR&#39;</span><span class="p">,</span> 
                 <span class="n">solar</span><span class="o">=</span><span class="s1">&#39;Lodders25&#39;</span><span class="p">,</span><span class="n">retrieval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_abunds</span> <span class="o">=</span> <span class="n">bulk_abunds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span> <span class="o">=</span> <span class="n">species_abunds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_errs</span> <span class="o">=</span> <span class="n">bulk_errs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span> <span class="o">=</span> <span class="n">species_errs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_type</span> <span class="o">=</span> <span class="n">species_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="n">solar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">=</span> <span class="n">retrieval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">possible_solars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lodders25&#39;</span><span class="p">,</span><span class="s1">&#39;Asplund09&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;Lodders20&#39;</span><span class="p">,</span><span class="s1">&#39;Asplund21&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;Lodders10&#39;</span><span class="p">,</span><span class="s1">&#39;Caffau11&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;Asplund05&#39;</span><span class="p">]</span>
        
        <span class="k">match</span> <span class="n">retrieval</span><span class="p">:</span>
            <span class="k">case</span> <span class="s1">&#39;pRT&#39;</span><span class="p">:</span> <span class="c1">#documentation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mh_type</span> <span class="o">=</span> <span class="s1">&#39;C/H&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">=</span> <span class="s1">&#39;O/H&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="s1">&#39;Asplund09&#39;</span>
            <span class="k">case</span> <span class="s1">&#39;PICASO&#39;</span><span class="p">:</span> <span class="c1">#Mukherjee et al. 2023</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mh_type</span> <span class="o">=</span> <span class="s1">&#39;(O+C)/H&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">=</span> <span class="s1">&#39;MH_Preserve&#39;</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="s1">&#39;Lodders10&#39;</span>
            <span class="k">case</span> <span class="s1">&#39;PETRA&#39;</span><span class="p">:</span> <span class="c1">#Lothringer &amp; Barman 2020</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mh_type</span> <span class="o">=</span> <span class="s1">&#39;O/H&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">=</span> <span class="s1">&#39;C/H&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="s1">&#39;Asplund05&#39;</span>
            <span class="k">case</span> <span class="s1">&#39;POSEIDON&#39;</span><span class="p">:</span> <span class="c1">#Kirk et al. 2025</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mh_type</span> <span class="o">=</span> <span class="s1">&#39;O/H&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">=</span> <span class="s1">&#39;C/H&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="s1">&#39;Asplund09&#39;</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sometimes POSEIDON varies O/H for C/O (Meech et al. 2025)&#39;</span><span class="p">)</span>
            <span class="k">case</span> <span class="s1">&#39;CHIMERA&#39;</span><span class="p">:</span> <span class="c1">#assuming same as sCHIMERA</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mh_type</span> <span class="o">=</span> <span class="s1">&#39;(O+C)/H&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">=</span> <span class="s1">&#39;MH_Preserve&#39;</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="s1">&#39;Asplund09&#39;</span>
            <span class="k">case</span> <span class="s1">&#39;sCHIMERA&#39;</span><span class="p">:</span> <span class="c1">#Mansfield et al. 2024 </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mh_type</span> <span class="o">=</span> <span class="s1">&#39;(O+C)/H&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">=</span> <span class="s1">&#39;MH_Preserve&#39;</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="s1">&#39;Asplund09&#39;</span>
            <span class="k">case</span> <span class="s1">&#39;SCARLET&#39;</span><span class="p">:</span>  <span class="c1">#Benneke 2015, now Pelletier et al. 2025 -&gt; fastchem</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mh_type</span> <span class="o">=</span> <span class="s1">&#39;O/H&#39;</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">=</span> <span class="s1">&#39;C/H&#39;</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="s1">&#39;Asplund09&#39;</span> <span class="c1">#unknown      </span>
            <span class="k">case</span> <span class="s1">&#39;ATMO&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mh_type</span> <span class="o">=</span> <span class="s1">&#39;(O+C)/H&#39;</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">=</span> <span class="s1">&#39;MH_Preserve&#39;</span>              
                <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="s1">&#39;Asplund09&#39;</span>
            <span class="k">case</span> <span class="s1">&#39;PLATON&#39;</span><span class="p">:</span> <span class="c1">##Kirk et al. 2025</span>
                <span class="c1">#uses ggchem but hard to tell how</span>
                <span class="c1">#built on fastchem which uses asplund09</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mh_type</span> <span class="o">=</span> <span class="s1">&#39;O/H&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">=</span> <span class="s1">&#39;C/H&#39;</span>            
                <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="s1">&#39;Asplund09&#39;</span>
            <span class="k">case</span> <span class="s1">&#39;Gibson&#39;</span><span class="p">:</span> <span class="c1">#Ramkumar et al. 2025</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mh_type</span> <span class="o">=</span> <span class="s1">&#39;(O+C)/H&#39;</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">=</span> <span class="s1">&#39;MH_Preserve&#39;</span>     
                <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="s1">&#39;Asplund09&#39;</span>   
            <span class="c1">#case &#39;Aurora&#39;: #Welbanks &amp; Madhusudhan 2021</span>
                <span class="c1">#self.mh_type = &#39;O/H&#39;</span>
                <span class="c1">#self.co_type = &#39;C/H&#39;</span>
                <span class="c1">#self.solar = &#39;Asplund09&#39;</span>
           <span class="c1"># case &#39;NEMESIS&#39;:</span>
            
           <span class="c1"># case &#39;Hydra&#39;:</span>
                
                   
        <span class="k">match</span> <span class="n">solar</span><span class="p">:</span>
            <span class="k">case</span> <span class="s1">&#39;Lodders25&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lodders25</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Asplund09&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Asplund09</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Asplund05&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Asplund09</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Asplund21&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Asplund21</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Lodders20&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lodders20</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Lodders10&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lodders10</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Caffau11&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using abundances from Caffau11, filling in </span><span class="se">\</span>
<span class="s1">                      elements not included with Asplund09&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Caffau11</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please define Abund.solar_abundances&#39;</span><span class="p">)</span></div>

                
<div class="viewcode-block" id="Abund.define_stellar">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.define_stellar">[docs]</a>
    <span class="k">def</span> <span class="nf">define_stellar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abund_dict</span><span class="p">):</span>
        <span class="c1">#will use self.solar as backup</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">abund_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">solar_abundance</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">abund_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span></div>

    
<div class="viewcode-block" id="Abund.VMR_to_MMR">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.VMR_to_MMR">[docs]</a>
    <span class="k">def</span> <span class="nf">VMR_to_MMR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vmr_dict</span><span class="p">,</span> <span class="n">mmw</span><span class="o">=</span><span class="mf">2.3</span><span class="p">,</span> <span class="n">replace_abunds</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_masses</span><span class="p">()</span>
        <span class="n">mmr_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vmr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecular_mass</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> not in molecular mass dictionary. Skipping. Please add.&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">mmr_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">vmr_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecular_mass</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">/</span> <span class="n">mmw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">replace_abunds</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span> <span class="o">=</span> <span class="n">mmr_dict</span>
        <span class="k">return</span> <span class="n">mmr_dict</span></div>

    
<div class="viewcode-block" id="Abund.MMR_to_VMR">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.MMR_to_VMR">[docs]</a>
    <span class="k">def</span> <span class="nf">MMR_to_VMR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mmr_dict</span><span class="p">,</span> <span class="n">mmw</span><span class="o">=</span><span class="mf">2.3</span><span class="p">,</span> <span class="n">replace_abunds</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_masses</span><span class="p">()</span>
        <span class="n">vmr_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mmr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecular_mass</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> not in molecular mass dictionary. Skipping. Please add.&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">vmr_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">mmr_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="n">mmw</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecular_mass</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">replace_abunds</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span> <span class="o">=</span> <span class="n">vmr_dict</span>
        <span class="k">return</span> <span class="n">vmr_dict</span></div>

    
<div class="viewcode-block" id="Abund.convert_bulk_abundance">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.convert_bulk_abundance">[docs]</a>
    <span class="k">def</span> <span class="nf">convert_bulk_abundance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mh</span><span class="p">,</span><span class="n">co</span><span class="p">,</span><span class="n">rv</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">mh_err</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">co_err</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">rv_err</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">solar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert bulk abundance parameters to elemental abundances with error propagation.</span>
<span class="sd">        </span>
<span class="sd">        This method transforms fundamental stellar/planetary parameters (metallicity, C/O ratio, </span>
<span class="sd">        and refractory enhancement) into individual elemental abundances relative to hydrogen.</span>
<span class="sd">        It supports both symmetric/asymmetric error propagation and posterior sampling for </span>
<span class="sd">        uncertainty quantification.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mh : float or array-like</span>
<span class="sd">            Metallicity [M/H] in dex. Can be a single value or array for posterior sampling.</span>
<span class="sd">        co : float or array-like</span>
<span class="sd">            Carbon-to-oxygen ratio. Interpretation depends on `co_type` attribute:</span>
<span class="sd">            </span>
<span class="sd">            * &#39;O/H&#39;: C/O ratio, oxygen abundance adjusted</span>
<span class="sd">            * &#39;C/H&#39;: C/O ratio, carbon abundance adjusted  </span>
<span class="sd">            * &#39;MH_Preserve&#39;: C/O ratio, preserves total C+O abundance</span>
<span class="sd">            </span>
<span class="sd">        rv : float or array-like, optional</span>
<span class="sd">            Refractory enhancement factor in dex for elements heavier than oxygen.</span>
<span class="sd">            Default is 0.0 (no enhancement).</span>
<span class="sd">        mh_err : float, list, or array-like, optional</span>
<span class="sd">            Uncertainty in metallicity. Can be:</span>
<span class="sd">            </span>
<span class="sd">            * Single float: symmetric error</span>
<span class="sd">            * 2-element list: [lower, upper] asymmetric errors</span>
<span class="sd">            * Array: posterior samples</span>
<span class="sd">            </span>
<span class="sd">            Default is 0.0.</span>
<span class="sd">        co_err : float, list, or array-like, optional</span>
<span class="sd">            Uncertainty in C/O ratio, same format as `mh_err`. Default is 0.0.</span>
<span class="sd">        rv_err : float, list, or array-like, optional</span>
<span class="sd">            Uncertainty in refractory enhancement, same format as `mh_err`. Default is 0.0.</span>
<span class="sd">        solar : str, optional</span>
<span class="sd">            Solar abundance reference to use. If provided, overrides current solar abundance.</span>
<span class="sd">            Supported values: &#39;Lodders25&#39;, &#39;Asplund09&#39;, &#39;Asplund05&#39;, &#39;Asplund21&#39;, </span>
<span class="sd">            &#39;Lodders20&#39;, &#39;Lodders10&#39;, &#39;Caffau11&#39;. Default uses current `self.solar`.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bulk_dict : dict</span>
<span class="sd">            Dictionary of elemental abundances in the format log10(X/H) + 12, where</span>
<span class="sd">            keys are element symbols and values are abundances.</span>
<span class="sd">        err_dict : dict</span>
<span class="sd">            Dictionary of abundance uncertainties with same keys as `bulk_dict`.</span>
<span class="sd">            </span>
<span class="sd">            * For symmetric/asymmetric errors: contains propagated uncertainties</span>
<span class="sd">            * For posterior sampling: contains arrays of posterior abundance samples</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method requires the following class attributes to be set:</span>
<span class="sd">        </span>
<span class="sd">        * `mh_type`: Metallicity parameterization type</span>
<span class="sd">        * `co_type`: C/O ratio treatment (&#39;O/H&#39;, &#39;C/H&#39;, or &#39;MH_Preserve&#39;)</span>
<span class="sd">        * `solar`: Solar abundance reference (if `solar` parameter not provided)</span>
<span class="sd">        </span>
<span class="sd">        The method automatically detects whether inputs represent:</span>
<span class="sd">        </span>
<span class="sd">        1. **Single values with errors**: Standard error propagation using Gaussian approximation</span>
<span class="sd">        2. **Posterior samples**: Full posterior propagation through the abundance calculation</span>
<span class="sd">        </span>
<span class="sd">        For elements heavier than oxygen (Z &gt; 8), the refractory enhancement `rv` is applied </span>
<span class="sd">        as an additional multiplicative factor in dex space.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # Single value with symmetric errors</span>
<span class="sd">        &gt;&gt;&gt; bulk_dict, err_dict = obj.convert_bulk_abundance(</span>
<span class="sd">        ...     mh=0.1, co=0.55, rv=0.2, mh_err=0.05, co_err=0.03, rv_err=0.1</span>
<span class="sd">        ... )</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; # Asymmetric errors</span>
<span class="sd">        &gt;&gt;&gt; bulk_dict, err_dict = obj.convert_bulk_abundance(</span>
<span class="sd">        ...     mh=0.1, co=0.55, mh_err=[-0.03, 0.07], co_err=[-0.02, 0.04]</span>
<span class="sd">        ... )</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; # Posterior sampling</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; mh_samples = np.random.normal(0.1, 0.05, 1000)</span>
<span class="sd">        &gt;&gt;&gt; co_samples = np.random.normal(0.55, 0.03, 1000)</span>
<span class="sd">        &gt;&gt;&gt; bulk_dict, err_dict = obj.convert_bulk_abundance(</span>
<span class="sd">        ...     mh=0.1, co=0.55, mh_err=mh_samples, co_err=co_samples</span>
<span class="sd">        ... )</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        init_ec : Initialize elemental composition object</span>
<span class="sd">        </span>
<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        Solar abundance compilations used depend on the `solar` parameter choice.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mh_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please define retrieval-type or mh_type, co_type, and solar_type&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span><span class="p">:</span>
            <span class="k">case</span> <span class="s1">&#39;O/H&#39;</span><span class="p">:</span>
                <span class="n">adjust_C</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">case</span> <span class="s1">&#39;C/H&#39;</span><span class="p">:</span>
                <span class="n">adjust_C</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">case</span> <span class="s1">&#39;MH_Preserve&#39;</span><span class="p">:</span>
                <span class="n">adjust_C</span> <span class="o">=</span> <span class="s1">&#39;Neither&#39;</span>
        
        <span class="c1"># Re-define solar abundances       </span>
        <span class="k">if</span> <span class="n">solar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">solar</span> <span class="o">=</span> <span class="n">solar</span>
        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar</span><span class="p">:</span>
            <span class="k">case</span> <span class="s1">&#39;Lodders25&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lodders25</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Asplund09&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Asplund09</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Asplund05&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Asplund09</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Asplund21&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Asplund21</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Lodders20&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lodders20</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Lodders10&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lodders10</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span> <span class="s1">&#39;Caffau11&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using abundances from Caffau11, filling in </span><span class="se">\</span>
<span class="s1">                      elements not included with Asplund09&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Caffau11</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please define Abund.solar_abundances&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">solar</span><span class="si">}</span><span class="s2"> solar abundances&quot;</span><span class="p">)</span>
        
        <span class="n">exo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_ec</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">get_comp</span><span class="p">(</span><span class="n">mh</span><span class="p">,</span><span class="n">co</span><span class="p">,</span><span class="n">rv</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        
            <span class="n">exo</span><span class="o">.</span><span class="n">metallicity</span> <span class="o">=</span> <span class="n">mh</span>
            <span class="c1">#Adjust C/O either by changing C/H or O/H:</span>
            <span class="k">if</span> <span class="n">adjust_C</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">co</span>
            <span class="k">elif</span> <span class="n">adjust_C</span> <span class="o">==</span> <span class="s1">&#39;Neither&#39;</span><span class="p">:</span>
                <span class="n">tot</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="c1">#co = exo.atomAbunds[2] / exo.atomAbunds[4]</span>
                <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">co</span> <span class="o">*</span> <span class="n">tot</span> <span class="o">/</span> <span class="p">(</span><span class="n">co</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span> <span class="o">/</span> <span class="p">(</span><span class="n">co</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exo</span><span class="o">.</span><span class="n">co</span> <span class="o">=</span> <span class="n">co</span> <span class="c1">#easychem changes O/H by default</span>
                
            <span class="c1">#Enhance elements above O by rv</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">)):</span>
                <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">rv</span><span class="p">)</span>
            
            <span class="k">return</span>
       
        <span class="n">get_comp</span><span class="p">(</span><span class="n">mh</span><span class="p">,</span><span class="n">co</span><span class="p">,</span><span class="n">rv</span><span class="p">)</span>
        
        <span class="n">bulk_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">err_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
            <span class="n">bulk_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">1e12</span><span class="p">)</span>
            <span class="n">err_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mh_err</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mh_err</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># asymmetric errors</span>
                <span class="n">s</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># don&#39;t treat as posterior</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># If we have errors (symmetric or asymmetric)     </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">==</span> <span class="s1">&#39;O/H&#39;</span><span class="p">:</span>
                <span class="c1">#Then error in O is set also by error in C/O</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mh_err</span><span class="p">)</span>
                    <span class="n">err_dict</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mh_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">co_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">err_dict</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mh_err</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">co_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">==</span> <span class="s1">&#39;C/H&#39;</span><span class="p">:</span>
                <span class="c1">#Error in C is set also by error in C/O</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mh_err</span><span class="p">)</span>
                    <span class="n">err_dict</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mh_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">co_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">err_dict</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mh_err</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">co_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">co_type</span> <span class="o">==</span> <span class="s1">&#39;Neither&#39;</span><span class="p">:</span>
                <span class="c1">#Unsure here, conservatively, let&#39;s place C/O error on both...</span>
                <span class="c1">#I think one could split the C/O error but need to think about that</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mh_err</span><span class="p">)</span>
                    <span class="n">err_dict</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mh_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">co_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                    <span class="n">err_dict</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mh_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">co_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">err_dict</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mh_err</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">co_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">err_dict</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mh_err</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">co_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rv_err</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="c1">#Again, will be correlated usually, but without posteriors, assume Gauss</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">)):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mh_err</span><span class="p">)</span>
                        <span class="n">err_dict</span><span class="p">[</span><span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mh_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rv_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">err_dict</span><span class="p">[</span><span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mh_err</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">rv_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
            <span class="bp">self</span><span class="o">.</span><span class="n">bulk_abunds</span> <span class="o">=</span> <span class="n">bulk_dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bulk_errs</span> <span class="o">=</span> <span class="n">err_dict</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># If we have posteriors</span>
            <span class="n">err_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="n">err_dict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mh_err</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">get_comp</span><span class="p">(</span><span class="n">mh_err</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">co_err</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">rv_err</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">get_comp</span><span class="p">(</span><span class="n">mh_err</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">co_err</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">)):</span>
                    <span class="n">err_dict</span><span class="p">[</span><span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">1e12</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bulk_errs</span> <span class="o">=</span> <span class="n">err_dict</span>
        <span class="k">return</span> <span class="n">bulk_dict</span><span class="p">,</span><span class="n">err_dict</span></div>


<div class="viewcode-block" id="Abund.convert_solar">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.convert_solar">[docs]</a>
    <span class="k">def</span> <span class="nf">convert_solar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">convert_to</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert existing bulk abundances to a different solar abundance reference.</span>

<span class="sd">        This method transforms previously calculated elemental abundances from one solar </span>
<span class="sd">        abundance scale to another while preserving the relative abundances. The conversion</span>
<span class="sd">        accounts for differences between solar abundance compilations by applying appropriate</span>
<span class="sd">        offset corrections to maintain consistency in the abundance ratios.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        convert_to : str</span>
<span class="sd">            Target solar abundance reference scale. Supported values:</span>
<span class="sd">            </span>
<span class="sd">            * &#39;Lodders25&#39;: Lodders (2025) solar photospheric abundances</span>
<span class="sd">            * &#39;Asplund09&#39;: Asplund et al. (2009) solar photospheric abundances  </span>
<span class="sd">            * &#39;Asplund21&#39;: Asplund et al. (2021) solar photospheric abundances</span>
<span class="sd">            * &#39;Lodders20&#39;: Lodders (2020) solar photospheric abundances</span>
<span class="sd">            * &#39;Lodders10&#39;: Lodders (2010) solar photospheric abundances</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Method modifies class attributes (self.bulk_abunds and sel.fsolar_abundances) </span>
<span class="sd">            in-place and prints status messages.</span>
<span class="sd">    </span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method modifies the following class attributes:</span>
<span class="sd">        </span>
<span class="sd">        * `solar_abundances`: Updated to the new solar abundance reference</span>
<span class="sd">        * `bulk_abunds`: Element abundances converted to the new solar scale</span>
<span class="sd">        * `solar_abundances_orig`: Changes at the end</span>
<span class="sd">        </span>
<span class="sd">        The conversion preserves the physical meaning of abundance ratios by applying</span>
<span class="sd">        the transformation:</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            [X/H]_{new} = [X/H]_{old} - ([X/H]_{solar,new} - [X/H]_{solar,old})</span>
<span class="sd">        </span>
<span class="sd">        where the solar abundance difference accounts for systematic offsets between</span>
<span class="sd">        different solar abundance compilations.</span>
<span class="sd">        </span>
<span class="sd">        **Behavior when no bulk abundances exist:**</span>
<span class="sd">        </span>
<span class="sd">        If `bulk_abunds` is None (no previous abundance calculation), the method only</span>
<span class="sd">        updates the solar abundance reference without performing any conversions.</span>
<span class="sd">        </span>
<span class="sd">        **Workflow Integration:**</span>
<span class="sd">        </span>
<span class="sd">        This method is typically used after `convert_bulk_abundance()` when you want</span>
<span class="sd">        to compare results using different solar abundance scales or when literature</span>
<span class="sd">        values use a different solar reference than your initial calculation.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # After calculating abundances with one solar reference</span>
<span class="sd">        &gt;&gt;&gt; obj.convert_bulk_abundance(mh=0.1, co=0.55, solar=&#39;Asplund09&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # Convert to a different solar abundance scale</span>
<span class="sd">        &gt;&gt;&gt; obj.convert_solar(&#39;Lodders25&#39;)</span>
<span class="sd">        Changed solar abunds to Lodders25</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; # If no bulk abundances calculated yet</span>
<span class="sd">        &gt;&gt;&gt; obj.convert_solar(&#39;Asplund21&#39;) </span>
<span class="sd">        Changed solar abunds to Asplund21</span>
<span class="sd">        No bulk abundances to convert...</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; # Invalid solar reference</span>
<span class="sd">        &gt;&gt;&gt; obj.convert_solar(&#39;InvalidRef&#39;)</span>
<span class="sd">        Input solar not recognized</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        convert_bulk_abundance : Calculate initial elemental abundances</span>
<span class="sd">        </span>
<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        Solar abundance scales and their systematic differences are discussed in:</span>
<span class="sd">        </span>
<span class="sd">        * Asplund, M., et al. (2009). ARA&amp;A, 47, 481</span>
<span class="sd">        * Asplund, M., et al. (2021). A&amp;A, 653, A141  </span>
<span class="sd">        * Lodders, K. (2010). Astrophys. Space Sci., 334, 1</span>
<span class="sd">        * Lodders, K. (2020). Space Sci. Rev., 216, 44</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">match</span> <span class="n">convert_to</span><span class="p">:</span>
            <span class="k">case</span> <span class="s1">&#39;Lodders25&#39;</span><span class="p">:</span>
                <span class="n">solar_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lodders25</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Changed solar abunds to Lodders25&#39;</span><span class="p">)</span>
            <span class="k">case</span> <span class="s1">&#39;Asplund09&#39;</span><span class="p">:</span>   
                <span class="n">solar_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Asplund09</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Changed solar abunds to Asplund09&#39;</span><span class="p">)</span>
            <span class="k">case</span> <span class="s1">&#39;Asplund21&#39;</span><span class="p">:</span>
                <span class="n">solar_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Asplund21</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Changed solar abunds to Asplund21&#39;</span><span class="p">)</span>
            <span class="k">case</span> <span class="s1">&#39;Lodders20&#39;</span><span class="p">:</span>
                <span class="n">solar_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lodders20</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Changed solar abunds to Lodders20&#39;</span><span class="p">)</span>
            <span class="k">case</span> <span class="s1">&#39;Lodders10&#39;</span><span class="p">:</span>
                <span class="n">solar_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lodders10</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Changed solar abunds to Lodders10&#39;</span><span class="p">)</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input solar not recognized&#39;</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_abunds</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="n">solar_new</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="n">solar_new</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No bulk abundances to convert...&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_abunds</span><span class="p">:</span>
            <span class="c1">#Conversion factor</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">solar_new</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
            <span class="c1">#print(factor,solar_new[element][0],self.solar_abundances_orig[element][0])</span>
            
            <span class="c1">#Convert</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bulk_abunds</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_abunds</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">-</span> <span class="n">factor</span> <span class="c1">#minus b/c increase/decrease in planet *relative to solar/star*</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span> <span class="o">=</span> <span class="n">solar_new</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances_orig</span> <span class="o">=</span> <span class="n">solar_new</span>
        <span class="k">return</span></div>

    

<div class="viewcode-block" id="Abund.init_ec">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.init_ec">[docs]</a>
    <span class="k">def</span> <span class="nf">init_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to initialize easyCHEM with the elemental abundances from the</span>
<span class="sd">        present definition of solar.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        exo : obj</span>
<span class="sd">            easyCHEM object</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#Init easychem</span>
        <span class="n">exo</span> <span class="o">=</span> <span class="n">ec</span><span class="o">.</span><span class="n">ExoAtmos</span><span class="p">()</span>
        
        <span class="n">reactants</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">reactants</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">reactants</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reactants</span><span class="p">,</span><span class="s1">&#39;Fe+&#39;</span><span class="p">)</span>
        <span class="c1">#reactants = np.append(reactants,&#39;Mg+&#39;)</span>
        <span class="c1">#reactants = np.append(reactants,&#39;C2H2&#39;)    </span>
        <span class="c1">#reactants = np.append(reactants,&#39;C2H4&#39;)                                                                                                                                                                                                        </span>
        <span class="n">exo</span><span class="o">.</span><span class="n">updateReactants</span><span class="p">(</span><span class="n">reactants</span><span class="p">)</span>
        
        <span class="c1">#Update easychem abunds</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">solar_abundances</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">exo</span><span class="o">.</span><span class="n">updateAtomAbunds</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exo</span></div>

    
    
<div class="viewcode-block" id="Abund.predict_abund">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.predict_abund">[docs]</a>
    <span class="k">def</span> <span class="nf">predict_abund</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mh</span><span class="p">,</span><span class="n">co</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H2O&#39;</span><span class="p">,</span><span class="s1">&#39;CO&#39;</span><span class="p">,</span><span class="s1">&#39;CO2&#39;</span><span class="p">],</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;VMR&#39;</span><span class="p">,</span> <span class="n">adjust_C</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict molecular abundances from bulk parameters and atmospheric conditions.</span>
<span class="sd">        </span>
<span class="sd">        Calculates equilibrium molecular abundances for specified species given </span>
<span class="sd">        metallicity, C/O ratio, temperature, and pressure.</span>
<span class="sd">        Uses the definition of solar in self.solar!</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mh : float</span>
<span class="sd">            Metallicity [M/H] in dex.</span>
<span class="sd">        co : float</span>
<span class="sd">            Carbon-to-oxygen ratio.</span>
<span class="sd">        T : float</span>
<span class="sd">            Temperature in Kelvin.</span>
<span class="sd">        P : float</span>
<span class="sd">            Pressure in bar.</span>
<span class="sd">        species : list of str, optional</span>
<span class="sd">            Molecular species to calculate. Default is [&#39;H2O&#39;,&#39;CO&#39;,&#39;CO2&#39;].</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            Print abundances to console. Default is True.</span>
<span class="sd">        mode : {&#39;VMR&#39;, &#39;MMR&#39;}, optional</span>
<span class="sd">            Return volume mixing ratios (&#39;VMR&#39;) or mass mixing ratios (&#39;MMR&#39;). </span>
<span class="sd">            Default is &#39;VMR&#39;.</span>
<span class="sd">        adjust_C : bool, optional</span>
<span class="sd">            If True, adjust carbon abundance to match C/O ratio. If False, </span>
<span class="sd">            adjust oxygen abundance. Default is True.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary with species names as keys and log10 abundances as values.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # Predict H2O, CO, CO2 abundances</span>
<span class="sd">        &gt;&gt;&gt; abunds = obj.predict_abund(mh=0.0, co=0.55, T=1500, P=1.0)</span>
<span class="sd">        H2O: -3.2</span>
<span class="sd">        CO: -3.8</span>
<span class="sd">        CO2: -7.1</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; # Custom species list, silent mode</span>
<span class="sd">        &gt;&gt;&gt; abunds = obj.predict_abund(mh=0.5, co=0.8, T=2000, P=10.0, </span>
<span class="sd">        ...                          species=[&#39;CH4&#39;, &#39;NH3&#39;], verbose=False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">exo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_ec</span><span class="p">()</span>
        
        <span class="n">exo</span><span class="o">.</span><span class="n">metallicity</span> <span class="o">=</span> <span class="n">mh</span>
        <span class="c1">#Adjust C/O either by changing C/H or O/H:</span>
        <span class="k">if</span> <span class="n">adjust_C</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">co</span>
        <span class="k">elif</span> <span class="n">adjust_C</span> <span class="o">==</span> <span class="s1">&#39;Neither&#39;</span><span class="p">:</span>
            <span class="n">tot</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="c1">#co = exo.atomAbunds[2] / exo.atomAbunds[4]</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">co</span> <span class="o">*</span> <span class="n">tot</span> <span class="o">/</span> <span class="p">(</span><span class="n">co</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span> <span class="o">/</span> <span class="p">(</span><span class="n">co</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">co</span> <span class="o">=</span> <span class="n">co</span> <span class="c1">#easychem changes O/H by default</span>
        <span class="n">exo</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;VMR&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">result_mol</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;MMR&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">result_mass</span><span class="p">()</span>
        <span class="n">ret_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">s</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ret_dict</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ret_dict</span></div>

    
<div class="viewcode-block" id="Abund.convert_species_abunds">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.convert_species_abunds">[docs]</a>
    <span class="k">def</span> <span class="nf">convert_species_abunds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">adjust_C</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_it</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">posterior_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">fit_refvol</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit bulk atmospheric parameters to observed molecular abundances.</span>
<span class="sd">        </span>
<span class="sd">        Performs inverse retrieval to determine metallicity [M/H], C/O ratio, and </span>
<span class="sd">        optionally refractory enhancement from observed molecular species abundances</span>
<span class="sd">        using thermochemical equilibrium modeling. Supports both error propagation</span>
<span class="sd">        and full posterior sampling.</span>
<span class="sd">        </span>
<span class="sd">        IMPORTANT: This assumes chemical equilibrium, of course! Results can be very</span>
<span class="sd">        sensitive to the assumed T and P. And atmospheres are not necessarily in </span>
<span class="sd">        equilibrium. Interpret these results with care.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        T : float</span>
<span class="sd">            Atmospheric temperature in Kelvin for which the species abundances are representative.</span>
<span class="sd">        P : float</span>
<span class="sd">            Atmospheric pressure in bar for which the species abundances are representative.</span>
<span class="sd">        adjust_C : bool, optional</span>
<span class="sd">            Carbon adjustment method for C/O ratio. If True, adjust carbon abundance;</span>
<span class="sd">            if False, adjust oxygen abundance. If string &#39;Neither&#39; conserve [M/H].</span>
<span class="sd">            Default is True.</span>
<span class="sd">        plot_it : bool, optional</span>
<span class="sd">            Generate diagnostic plots showing fit results and parameter distributions.</span>
<span class="sd">            Default is True.</span>
<span class="sd">        posterior_samples : int, optional</span>
<span class="sd">            Number of posterior samples to use when `species_errs` contains posteriors.</span>
<span class="sd">            Default is 100.</span>
<span class="sd">        fit_refvol : bool, optional</span>
<span class="sd">            Include refractory enhancement (R/V) as a free parameter in the fit.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        popt : list</span>
<span class="sd">            Best-fit parameters [M/H, C/O] or [M/H, C/O, R/V] if `fit_refvol=True`.</span>
<span class="sd">        pcov : array-like or list</span>
<span class="sd">            Parameter covariance matrix (for error-based fitting) or list of </span>
<span class="sd">            posterior samples (for posterior-based fitting).</span>
<span class="sd">        best_fit : array</span>
<span class="sd">            Model predictions for molecular abundances at best-fit parameters.</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method requires the following class attributes to be set:</span>
<span class="sd">        </span>
<span class="sd">        * `species_abunds`: Dictionary of observed molecular abundances</span>
<span class="sd">        * `species_errs`: Uncertainties (symmetric, asymmetric, or posteriors)</span>
<span class="sd">        </span>
<span class="sd">        **Fitting Methods:**</span>
<span class="sd">        </span>
<span class="sd">        1. **Symmetric errors**: Uses `scipy.optimize.curve_fit` with Gaussian likelihood</span>
<span class="sd">        2. **Asymmetric errors**: Uses `scipy.optimize.fmin` with custom chi-squared</span>
<span class="sd">        3. **Posterior samples**: Fits each sample individually, returns percentiles</span>
<span class="sd">        </span>
<span class="sd">        **Parameter Bounds:**</span>
<span class="sd">        </span>
<span class="sd">        * Metallicity: -2.0 &lt; [M/H] &lt; 3.0</span>
<span class="sd">        * C/O ratio: 0.0 &lt; C/O &lt; 2.0</span>
<span class="sd">        * Model returns -1000 for abundances outside these bounds</span>
<span class="sd">        </span>
<span class="sd">        The method updates several class attributes:</span>
<span class="sd">        </span>
<span class="sd">        * `best_fit_mh`, `best_fit_co`: Best-fit bulk parameters</span>
<span class="sd">        * `best_fit_refvol`: Best-fit refractory enhancement (if fitted)</span>
<span class="sd">        * `best_fit_abund`: Dictionary of best-fit molecular abundances  </span>
<span class="sd">        * `bulk_abunds`: Updated elemental abundances from best-fit parameters</span>
<span class="sd">        * `fits`: Posterior samples (for posterior-based fitting)</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # Basic fitting with symmetric errors</span>
<span class="sd">        &gt;&gt;&gt; obj.species_abunds = {&#39;H2O&#39;: -3.2, &#39;CO&#39;: -3.8, &#39;CO2&#39;: -7.1}</span>
<span class="sd">        &gt;&gt;&gt; obj.species_errs = {&#39;H2O&#39;: 0.1, &#39;CO&#39;: 0.15, &#39;CO2&#39;: 0.3}</span>
<span class="sd">        &gt;&gt;&gt; popt, pcov, fit = obj.convert_species_abunds(T=1500, P=1.0)</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; # Include refractory enhancement</span>
<span class="sd">        &gt;&gt;&gt; popt, pcov, fit = obj.convert_species_abunds(T=1500, P=1.0, fit_refvol=True)</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; # Posterior sampling (when species_errs contains arrays)</span>
<span class="sd">        &gt;&gt;&gt; popt, pcov, fit = obj.convert_species_abunds(T=1500, P=1.0, </span>
<span class="sd">        ...                                             posterior_samples=500)</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        AttributeError</span>
<span class="sd">            If `species_abunds` is not defined in the class instance.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If optimization fails to converge or input data is inconsistent.</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        predict_abund : Forward modeling of molecular abundances</span>
<span class="sd">        convert_bulk_abundance : Convert bulk parameters to elemental abundances</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consider adding errors/uncertainty to the provided measurements!&quot;</span><span class="p">)</span>
        
        <span class="c1">#Init easychem</span>
        <span class="n">exo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_ec</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">fit_species</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mh</span><span class="p">,</span><span class="n">co</span><span class="p">,</span><span class="n">rv</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="c1">#Put some bounds in so easychem doesn&#39;t flip out</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mh</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mh</span> <span class="o">&gt;</span> <span class="mf">3.0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1000.0</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">co</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">co</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1000.0</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">metallicity</span> <span class="o">=</span> <span class="n">mh</span> <span class="c1">#resets atomAbunds</span>
            <span class="c1">#Adjust C/O either by changing C/H or O/H:</span>
            <span class="k">if</span> <span class="n">adjust_C</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">co</span>
            <span class="k">elif</span> <span class="n">adjust_C</span> <span class="o">==</span> <span class="s1">&#39;Neither&#39;</span><span class="p">:</span>
                <span class="n">tot</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="c1">#co = exo.atomAbunds[2] / exo.atomAbunds[4]</span>
                <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">co</span> <span class="o">*</span> <span class="n">tot</span> <span class="o">/</span> <span class="p">(</span><span class="n">co</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span> <span class="o">/</span> <span class="p">(</span><span class="n">co</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exo</span><span class="o">.</span><span class="n">co</span> <span class="o">=</span> <span class="n">co</span> <span class="c1">#easychem changes O/H by default</span>
            <span class="c1">#Enhance elements above O by rv</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">)):</span>
                <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">rv</span><span class="p">)</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">result_mol</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">el</span><span class="p">])</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        
        <span class="k">def</span> <span class="nf">fit_species_loss</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">errs</span><span class="p">):</span>

            <span class="n">mh</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">co</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mh</span><span class="p">,</span><span class="n">co</span><span class="p">,</span><span class="n">rv</span><span class="p">)</span>
            
            <span class="n">chi2</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">errs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="c1"># Asymmetric error handling</span>
                <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="n">chi2</span> <span class="o">+=</span> <span class="p">((</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">/</span> <span class="n">errs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">errs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="c1">#if only upper limit, don&#39;t penalize if below...</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">chi2</span> <span class="o">+=</span> <span class="p">((</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">/</span> <span class="n">errs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                    
            <span class="k">return</span> <span class="n">chi2</span>
        
        <span class="c1"># See if we have errors or posteriors</span>
        <span class="c1"># Dumb logic finds if we have 2 elements in errors, which means we were given asymmetric error bars</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="kc">None</span>
                
        <span class="c1"># If just given errors</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1">#if asymmetric errorbars given, use fmin</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">fit_refvol</span><span class="p">:</span>
                    <span class="n">popt</span> <span class="o">=</span> <span class="n">fmin</span><span class="p">(</span><span class="n">fit_species_loss</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">],</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="p">))</span>
                    <span class="n">best_fit</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>       
                    <span class="n">errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best fit [M/H]: </span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best fit C/O: </span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best fit R/V: </span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">popt</span> <span class="o">=</span> <span class="n">fmin</span><span class="p">(</span><span class="n">fit_species_loss</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="p">))</span>
                    <span class="n">best_fit</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>       
                    <span class="n">errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best fit [M/H]: </span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best fit C/O: </span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">chi</span> <span class="o">=</span> <span class="n">fit_species_loss</span><span class="p">(</span><span class="n">best_fit</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Chi^2 = </span><span class="si">{</span><span class="n">chi</span><span class="si">}</span><span class="s1">, Reduced Chi^2 = </span><span class="si">{</span><span class="n">chi</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="c1">#set sigma and pcov to None for below since they are not applicable</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">pcov</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># If errors are not lists, we must have been given symmetric uncertainties</span>
            <span class="k">else</span><span class="p">:</span>                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">sigma</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigma</span> <span class="o">=</span> <span class="p">[</span><span class="n">vals</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
                <span class="k">if</span> <span class="n">fit_refvol</span><span class="p">:</span>
                    <span class="n">popt</span><span class="p">,</span><span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">fit_species</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span>
                              <span class="p">[</span><span class="n">vals</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
                              <span class="n">sigma</span><span class="o">=</span><span class="p">[</span><span class="n">vals</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
                              <span class="n">absolute_sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">])</span>
                    <span class="n">best_fit</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                    
     
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best fit [M/H]: </span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">  +/- </span><span class="si">{</span><span class="n">errs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best fit C/O: </span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">  +/- </span><span class="si">{</span><span class="n">errs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best fit R/V: </span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">  +/- </span><span class="si">{</span><span class="n">errs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># same thing but without refvol</span>
                    <span class="n">popt</span><span class="p">,</span><span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">fit_species</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span>
                              <span class="p">[</span><span class="n">vals</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
                              <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
                              <span class="n">absolute_sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">])</span>
                    <span class="n">best_fit</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                    
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best fit [M/H]: </span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">  +/- </span><span class="si">{</span><span class="n">errs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best fit C/O: </span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">  +/- </span><span class="si">{</span><span class="n">errs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Best Fit Abundances&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">best_fit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="n">sigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">chi</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">chi</span> <span class="o">+=</span> <span class="p">(</span><span class="n">best_fit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Chi^2 = </span><span class="si">{</span><span class="n">chi</span><span class="si">}</span><span class="s1">, Reduced Chi^2 = </span><span class="si">{</span><span class="n">chi</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">plot_it</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="n">lower_err</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">upper_err</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">asymmetric_errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_err</span><span class="p">,</span> <span class="n">upper_err</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="n">yerr</span><span class="o">=</span><span class="n">asymmetric_errors</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="n">yerr</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
                    
                
                <span class="k">if</span> <span class="n">fit_refvol</span><span class="p">:</span>
                    <span class="n">highco</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">errs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">lowco</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">errs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">highmh</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">errs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">lowmh</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">errs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">highrv</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">errs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">lowrv</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">errs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    
                   <span class="c1">#print((best_fit-np.min([lowco,highco,lowmh,highmh,lowrv,highrv],axis=0),</span>
                   <span class="c1">#         np.max([lowco,highco,lowmh,highmh,lowrv,highrv],axis=0)-best_fit))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">best_fit</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                                    <span class="n">yerr</span> <span class="o">=</span> <span class="p">(</span><span class="n">best_fit</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">lowco</span><span class="p">,</span><span class="n">highco</span><span class="p">,</span><span class="n">lowmh</span><span class="p">,</span><span class="n">highmh</span><span class="p">,</span><span class="n">lowrv</span><span class="p">,</span><span class="n">highrv</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">lowco</span><span class="p">,</span><span class="n">highco</span><span class="p">,</span><span class="n">lowmh</span><span class="p">,</span><span class="n">highmh</span><span class="p">,</span><span class="n">lowrv</span><span class="p">,</span><span class="n">highrv</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">best_fit</span><span class="p">),</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Best-Fit +/- 1-sig Chem. Eq. </span><span class="se">\n</span><span class="s1">([M/H]=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, C/O=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, R/V=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)</span><span class="se">\n</span><span class="s1"> at </span><span class="si">{</span><span class="n">T</span><span class="si">}</span><span class="s1">K and </span><span class="si">{</span><span class="n">P</span><span class="si">}</span><span class="s1"> bars&#39;</span><span class="p">)</span>        
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unable to plot errorbars from M/H, C/O, R/V fit&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">best_fit</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Best-Fit Chem. Eq. </span><span class="se">\n</span><span class="s1">([M/H]=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, C/O=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, R/V=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)</span><span class="se">\n</span><span class="s1"> at </span><span class="si">{</span><span class="n">T</span><span class="si">}</span><span class="s1">K and </span><span class="si">{</span><span class="n">P</span><span class="si">}</span><span class="s1"> bars&#39;</span><span class="p">)</span>     
          
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">highco</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">errs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">lowco</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">errs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">highmh</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">errs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">lowmh</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">errs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">best_fit</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                                    <span class="n">yerr</span> <span class="o">=</span> <span class="p">(</span><span class="n">best_fit</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">lowco</span><span class="p">,</span><span class="n">highco</span><span class="p">,</span><span class="n">lowmh</span><span class="p">,</span><span class="n">highmh</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">lowco</span><span class="p">,</span><span class="n">highco</span><span class="p">,</span><span class="n">lowmh</span><span class="p">,</span><span class="n">highmh</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">best_fit</span><span class="p">),</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Best-Fit +/- 1-sig Chem. Eq. </span><span class="se">\n</span><span class="s1">([M/H]=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, C/O=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)</span><span class="se">\n</span><span class="s1"> at </span><span class="si">{</span><span class="n">T</span><span class="si">}</span><span class="s1">K and </span><span class="si">{</span><span class="n">P</span><span class="si">}</span><span class="s1"> bars&#39;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unable to plot errorbars from M/H, C/O, R/V fit&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">best_fit</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Best-Fit Chem. Eq. </span><span class="se">\n</span><span class="s1">([M/H]=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, C/O=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)</span><span class="se">\n</span><span class="s1"> at </span><span class="si">{</span><span class="n">T</span><span class="si">}</span><span class="s1">K and </span><span class="si">{</span><span class="n">P</span><span class="si">}</span><span class="s1"> bars&#39;</span><span class="p">)</span>                          
        
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Species&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Abundance (VMR)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span> 
            
        <span class="c1"># If given posteriors</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">samp</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">inds</span><span class="p">),</span><span class="n">posterior_samples</span><span class="p">)</span>
            <span class="n">fits</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">abunds</span> <span class="o">=</span> <span class="p">[[</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">samp</span><span class="p">]</span>
            <span class="c1">#print(np.shape(abunds))</span>
            <span class="c1">#print(abunds[0])</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Running on </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1"> samples... May take a moment if &gt;10&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samp</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">abunds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">fit_refvol</span><span class="p">:</span>
                    <span class="n">popt</span><span class="p">,</span><span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">fit_species</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span>
                              <span class="n">a</span><span class="p">,</span>
                              <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">popt</span><span class="p">,</span><span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">fit_species</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span>
                              <span class="n">a</span><span class="p">,</span>
                              <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">])</span>
                <span class="n">fits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">popt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fits</span> <span class="o">=</span> <span class="n">fits</span>
            <span class="n">mhs</span> <span class="o">=</span> <span class="p">[</span><span class="n">fits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fits</span><span class="p">))]</span>
            <span class="n">cos</span> <span class="o">=</span> <span class="p">[</span><span class="n">fits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fits</span><span class="p">))]</span>
            
            <span class="n">mhs_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mhs</span><span class="p">,</span><span class="mf">15.8655</span><span class="p">)</span>
            <span class="n">mhs_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mhs</span><span class="p">,</span><span class="mi">100</span><span class="o">-</span><span class="mf">15.8655</span><span class="p">)</span>
            <span class="n">mhs_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">mhs</span><span class="p">)</span>

            <span class="n">cos_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">cos</span><span class="p">,</span><span class="mf">15.8655</span><span class="p">)</span>
            <span class="n">cos_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">cos</span><span class="p">,</span><span class="mi">100</span><span class="o">-</span><span class="mf">15.8655</span><span class="p">)</span>    
            <span class="n">cos_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">cos</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metallicity - Median: </span><span class="si">{</span><span class="n">mhs_med</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Lower bound: </span><span class="si">{</span><span class="n">mhs_low</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Upper bound: </span><span class="si">{</span><span class="n">mhs_high</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;C/O - Median: </span><span class="si">{</span><span class="n">cos_med</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Lower bound: </span><span class="si">{</span><span class="n">cos_low</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Upper bound: </span><span class="si">{</span><span class="n">cos_high</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">fit_refvol</span><span class="p">:</span>
                <span class="n">refvol</span> <span class="o">=</span> <span class="p">[</span><span class="n">fits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fits</span><span class="p">))]</span>
                <span class="n">refvol_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">refvol</span><span class="p">,</span><span class="mf">15.8655</span><span class="p">)</span>
                <span class="n">refvol_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">refvol</span><span class="p">,</span><span class="mi">100</span><span class="o">-</span><span class="mf">15.8655</span><span class="p">)</span>    
                <span class="n">refvol_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">refvol</span><span class="p">)</span>   
                
                <span class="n">popt</span> <span class="o">=</span> <span class="p">[</span><span class="n">mhs_med</span><span class="p">,</span><span class="n">cos_med</span><span class="p">,</span><span class="n">refvol_med</span><span class="p">]</span>
                <span class="n">pcov</span> <span class="o">=</span> <span class="n">fits</span>
                <span class="n">best_fit</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="p">,</span><span class="n">cos_med</span><span class="p">)</span>
                
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ref/Vol - Median: </span><span class="si">{</span><span class="n">refvol_med</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Lower bound: </span><span class="si">{</span><span class="n">refvol_low</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Upper bound: </span><span class="si">{</span><span class="n">refvol_high</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
           
                <span class="n">popt</span> <span class="o">=</span> <span class="p">[</span><span class="n">mhs_med</span><span class="p">,</span><span class="n">cos_med</span><span class="p">]</span>
                <span class="n">pcov</span> <span class="o">=</span> <span class="n">fits</span>
                <span class="n">best_fit</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="p">,</span><span class="n">cos_med</span><span class="p">)</span>
                

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Median Fit Abundances&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">best_fit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
           
                
            <span class="k">if</span> <span class="n">plot_it</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fit_refvol</span><span class="p">:</span>
                    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refvol</span><span class="p">)</span>
                    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">refvol_med</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">refvol_low</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">refvol_high</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Ref/Vol&#39;</span><span class="p">)</span>


                    
                <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mhs</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">mhs_med</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">mhs_low</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">mhs_high</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>

                <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cos</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">cos_med</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">cos_low</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">cos_high</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                                    

                <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;[M/H]&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;C/O&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>      
                
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">species_errs</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.025</span><span class="p">)</span>
    

            <span class="k">if</span> <span class="n">fit_refvol</span><span class="p">:</span>
                <span class="n">highco</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="p">,</span><span class="n">cos_med</span><span class="o">+</span><span class="n">cos_high</span><span class="p">,</span><span class="n">refvol_med</span><span class="p">)</span>
                <span class="n">lowco</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="p">,</span><span class="n">cos_med</span><span class="o">-</span><span class="n">cos_low</span><span class="p">,</span><span class="n">refvol_med</span><span class="p">)</span>
                <span class="n">highmh</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="o">+</span><span class="n">mhs_high</span><span class="p">,</span><span class="n">cos_med</span><span class="p">,</span><span class="n">refvol_med</span><span class="p">)</span>
                <span class="n">lowmh</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="o">-</span><span class="n">mhs_low</span><span class="p">,</span><span class="n">cos_med</span><span class="p">,</span><span class="n">refvol_med</span><span class="p">)</span>
                <span class="n">highrv</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="p">,</span><span class="n">cos_med</span><span class="p">,</span><span class="n">refvol_med</span><span class="o">+</span><span class="n">refvol_high</span><span class="p">)</span>
                <span class="n">lowrv</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="p">,</span><span class="n">cos_med</span><span class="p">,</span><span class="n">refvol_med</span><span class="o">-</span><span class="n">refvol_low</span><span class="p">)</span>
            
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">best_fit</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                            <span class="n">yerr</span> <span class="o">=</span> <span class="p">(</span><span class="n">best_fit</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">lowco</span><span class="p">,</span><span class="n">highco</span><span class="p">,</span><span class="n">lowmh</span><span class="p">,</span><span class="n">highmh</span><span class="p">,</span><span class="n">lowrv</span><span class="p">,</span><span class="n">highrv</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">lowco</span><span class="p">,</span><span class="n">highco</span><span class="p">,</span><span class="n">lowmh</span><span class="p">,</span><span class="n">highmh</span><span class="p">,</span><span class="n">lowrv</span><span class="p">,</span><span class="n">highrv</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">best_fit</span><span class="p">),</span>
                            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Best-Fit +/- 1-sig Chem. Eq. </span><span class="se">\n</span><span class="s1">([M/H]=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, C/O=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, R/V=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)</span><span class="se">\n</span><span class="s1"> at </span><span class="si">{</span><span class="n">T</span><span class="si">}</span><span class="s1">K and </span><span class="si">{</span><span class="n">P</span><span class="si">}</span><span class="s1"> bars&#39;</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="n">highco</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="p">,</span><span class="n">cos_med</span><span class="o">+</span><span class="n">cos_high</span><span class="p">)</span>
                <span class="n">lowco</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="p">,</span><span class="n">cos_med</span><span class="o">-</span><span class="n">cos_low</span><span class="p">)</span>
                <span class="n">highmh</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="o">+</span><span class="n">mhs_high</span><span class="p">,</span><span class="n">cos_med</span><span class="p">)</span>
                <span class="n">lowmh</span> <span class="o">=</span> <span class="n">fit_species</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="p">)),</span><span class="n">mhs_med</span><span class="o">-</span><span class="n">mhs_low</span><span class="p">,</span><span class="n">cos_med</span><span class="p">)</span>
            
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">best_fit</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                            <span class="n">yerr</span> <span class="o">=</span> <span class="p">(</span><span class="n">best_fit</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">lowco</span><span class="p">,</span><span class="n">highco</span><span class="p">,</span><span class="n">lowmh</span><span class="p">,</span><span class="n">highmh</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">lowco</span><span class="p">,</span><span class="n">highco</span><span class="p">,</span><span class="n">lowmh</span><span class="p">,</span><span class="n">highmh</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">best_fit</span><span class="p">),</span>
                            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Best-Fit +/- 1-sig Chem. Eq. </span><span class="se">\n</span><span class="s1">([M/H]=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, C/O=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)</span><span class="se">\n</span><span class="s1"> at </span><span class="si">{</span><span class="n">T</span><span class="si">}</span><span class="s1">K and </span><span class="si">{</span><span class="n">P</span><span class="si">}</span><span class="s1"> bars&#39;</span><span class="p">)</span>  
                
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Species&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Abundance (VMR)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span> 
            
                     
        <span class="c1">#Save best fit M/H and C/O to object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_fit_mh</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_fit_co</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fit_refvol</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">best_fit_refvol</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        
        <span class="c1">#Save best fit abundances to object</span>
        <span class="n">best_fit_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">best_fit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_fit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_fit_abund</span> <span class="o">=</span> <span class="n">best_fit_dict</span>

        <span class="c1">#Place this new inferred bulk density into bulk abund attribute</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Updating bulk abundances with mean/median fit&#39;</span><span class="p">)</span>
        
        <span class="c1">#Init easychem</span>
        <span class="n">exo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_ec</span><span class="p">()</span>

        <span class="n">exo</span><span class="o">.</span><span class="n">metallicity</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#Adjust C/O either by changing C/H or O/H:</span>
        <span class="k">if</span> <span class="n">adjust_C</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">adjust_C</span> <span class="o">==</span> <span class="s1">&#39;Neither&#39;</span><span class="p">:</span>
            <span class="n">tot</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="c1">#co = exo.atomAbunds[2] / exo.atomAbunds[4]</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">tot</span> <span class="o">/</span> <span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span> <span class="o">/</span> <span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">co</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#easychem changes O/H by default</span>
            
        <span class="k">if</span> <span class="n">fit_refvol</span><span class="p">:</span>
            <span class="c1">#Enhance elements above O by rv</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">)):</span>
                <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        
        <span class="n">bulk_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
            <span class="n">bulk_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">exo</span><span class="o">.</span><span class="n">atomAbunds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">1e12</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_abunds</span> <span class="o">=</span> <span class="n">bulk_dict</span>

        <span class="k">return</span> <span class="n">popt</span><span class="p">,</span><span class="n">pcov</span><span class="p">,</span><span class="n">best_fit</span></div>


<div class="viewcode-block" id="Abund.Lodders25">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.Lodders25">[docs]</a>
    <span class="k">def</span> <span class="nf">Lodders25</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">solar_abundances</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">12.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">),</span>
            <span class="s2">&quot;He&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">10.984</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Li&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.35</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Be&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.48</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
            <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.85</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.46</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.90</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">),</span>
            <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.76</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.53</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Ne&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.95</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;Na&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.37</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Mg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.62</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Al&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.54</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.61</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.54</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.26</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Cl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.33</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Ar&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.62</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
            <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.18</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;K*&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.18</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Ca&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.41</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Sc&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.15</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Ti&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.07</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Cr&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.72</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Mn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.58</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Fe&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.54</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.98</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Ni&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.29</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Cu&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.34</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Zn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.70</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Ga&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.17</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">solar_abundances</span></div>


<div class="viewcode-block" id="Abund.Asplund09">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.Asplund09">[docs]</a>
    <span class="k">def</span> <span class="nf">Asplund09</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">solar_abundances</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">12.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">),</span>
            <span class="s2">&quot;He&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">10.93</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
            <span class="s2">&quot;Li&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;Be&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.38</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">),</span>
            <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.70</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">),</span>
            <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.43</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.83</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.69</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.56</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">),</span>
            <span class="s2">&quot;Ne&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.93</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;Na&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.24</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Mg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Al&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.45</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.51</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.41</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.12</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Cl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.50</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">),</span>
            <span class="s2">&quot;Ar&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.40</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">),</span>
            <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.03</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">),</span>
            <span class="s2">&quot;Ca&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.34</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Sc&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.15</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Ti&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.95</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.93</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
            <span class="s2">&quot;Cr&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.64</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Mn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.43</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Fe&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.50</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.99</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
            <span class="s2">&quot;Ni&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.22</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Cu&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.19</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Zn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.56</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Ga&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.04</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">),</span>
            <span class="s2">&quot;Ge&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.65</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">solar_abundances</span></div>


<div class="viewcode-block" id="Abund.Lodders20">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.Lodders20">[docs]</a>
    <span class="k">def</span> <span class="nf">Lodders20</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">solar_abundances</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="mf">12.00</span><span class="p">,</span>
            <span class="s2">&quot;He&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">10.994</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Li&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.35</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Be&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.40</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.85</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.56</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.94</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">),</span>
            <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.82</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
            <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.79</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">),</span>
            <span class="s2">&quot;Ne&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.24</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;Na&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.36</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Mg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.61</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Al&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.51</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.60</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
            <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.52</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.24</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Cl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.32</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Ar&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.59</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.16</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Ca&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.36</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Sc&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.13</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Ti&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.99</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.04</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Cr&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.72</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Mn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.56</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Fe&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.54</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.95</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Ni&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.29</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Cu&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.33</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Zn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.70</span><span class="p">,</span> <span class="mf">0.60</span><span class="p">),</span>
            <span class="s2">&quot;Ga&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.16</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Ge&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.68</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">)</span>  <span class="c1"># Presumed from periodic order</span>
        <span class="p">}</span>
            
        <span class="k">return</span> <span class="n">solar_abundances</span></div>

    
<div class="viewcode-block" id="Abund.Asplund21">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.Asplund21">[docs]</a>
    <span class="k">def</span> <span class="nf">Asplund21</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">solar_abundances</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">12.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">),</span>
            <span class="s2">&quot;He&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">10.914</span><span class="p">,</span> <span class="mf">0.013</span><span class="p">),</span>
            <span class="s2">&quot;Li&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.96</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Be&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.38</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">),</span>
            <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.70</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">),</span>
            <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.46</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.83</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
            <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.69</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.40</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
            <span class="s2">&quot;Ne&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.06</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Na&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.22</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Mg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.55</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Al&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.43</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.51</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.41</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.12</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Cl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.31</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">),</span>
            <span class="s2">&quot;Ar&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.38</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.07</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Ca&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.30</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Sc&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.14</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Ti&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.97</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
            <span class="s2">&quot;Cr&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.62</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Mn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.42</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Fe&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.46</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.94</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Ni&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.20</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Cu&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.18</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Zn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.56</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Ga&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.02</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Ge&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.62</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">)</span>
        <span class="p">}</span>   
        <span class="k">return</span> <span class="n">solar_abundances</span></div>

    
    <span class="k">def</span> <span class="nf">Lodders10</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">solar_abundances</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">12.00</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="s2">&quot;He&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">10.925</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Li&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.28</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Be&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.32</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.81</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.39</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.86</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">),</span>
            <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.73</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
            <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.44</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Ne&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.05</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;Na&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.29</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Mg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.54</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Al&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.46</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
            <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.53</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.45</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.16</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Cl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.25</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Ar&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.50</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.11</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Ca&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.31</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Sc&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.07</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Ti&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.93</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.99</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Cr&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.65</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Mn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
            <span class="s2">&quot;Fe&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.46</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
            <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
            <span class="s2">&quot;Ni&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.22</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Cu&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.27</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Zn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.65</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Ga&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.10</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Ge&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.59</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">)}</span>
        <span class="k">return</span> <span class="n">solar_abundances</span>
    
<div class="viewcode-block" id="Abund.Lodders10">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.Lodders10">[docs]</a>
    <span class="k">def</span> <span class="nf">Lodders10</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">solar_abundances</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">12.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">),</span>
            <span class="s2">&quot;He&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">10.93</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
            <span class="s2">&quot;Li&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;Be&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.38</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">),</span>
            <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.70</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">),</span>
            <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.39</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.78</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.66</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.56</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">),</span>
            <span class="s2">&quot;Ne&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.84</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Na&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.17</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Mg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.53</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">),</span>
            <span class="s2">&quot;Al&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.37</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.51</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.36</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.14</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Cl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.50</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">),</span>
            <span class="s2">&quot;Ar&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.18</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
            <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.08</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
            <span class="s2">&quot;Ca&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.31</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Sc&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.05</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
            <span class="s2">&quot;Ti&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.90</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
            <span class="s2">&quot;Cr&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.64</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;Mn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.39</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Fe&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.45</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.92</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
            <span class="s2">&quot;Ni&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.23</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Cu&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.21</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Zn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.60</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Ga&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.88</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;Ge&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.58</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">solar_abundances</span></div>

    
<div class="viewcode-block" id="Abund.Caffau11">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.Caffau11">[docs]</a>
    <span class="k">def</span> <span class="nf">Caffau11</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Asplund09 fill in the rest</span>
        <span class="n">solar_abundances</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">12.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">),</span>
            <span class="s2">&quot;He&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">10.93</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
            <span class="s2">&quot;Li&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Be&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.38</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">),</span>
            <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.70</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">),</span>
            <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.50</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.86</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">),</span>
            <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.76</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
            <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.56</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">),</span>
            <span class="s2">&quot;Ne&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.93</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="s2">&quot;Na&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.24</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Mg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Al&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.45</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.51</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.46</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.16</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Cl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.50</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">),</span>
            <span class="s2">&quot;Ar&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.40</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">),</span>
            <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.11</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">),</span>
            <span class="s2">&quot;Ca&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.34</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Sc&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.15</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Ti&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.95</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.93</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span>
            <span class="s2">&quot;Cr&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.64</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Mn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.43</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Fe&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.52</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">),</span>
            <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.99</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
            <span class="s2">&quot;Ni&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.22</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Cu&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.19</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">),</span>
            <span class="s2">&quot;Zn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.56</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
            <span class="s2">&quot;Ga&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.04</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">),</span>
            <span class="s2">&quot;Ge&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.65</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">solar_abundances</span></div>

    
<div class="viewcode-block" id="Abund.import_masses">
<a class="viewcode-back" href="../exocomp.html#exocomp.Abund.import_masses">[docs]</a>
    <span class="k">def</span> <span class="nf">import_masses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecular_mass</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># Atoms</span>
            <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mf">1.00784</span><span class="p">,</span>
            <span class="s1">&#39;He&#39;</span><span class="p">:</span> <span class="mf">4.002602</span><span class="p">,</span>
            <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">12.0107</span><span class="p">,</span>
            <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">14.0067</span><span class="p">,</span>
            <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mf">18.998403163</span><span class="p">,</span>
            <span class="s1">&#39;Ne&#39;</span><span class="p">:</span> <span class="mf">20.1797</span><span class="p">,</span>
            <span class="s1">&#39;Na&#39;</span><span class="p">:</span> <span class="mf">22.98976928</span><span class="p">,</span>
            <span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="mf">24.305</span><span class="p">,</span>
            <span class="s1">&#39;Al&#39;</span><span class="p">:</span> <span class="mf">26.9815385</span><span class="p">,</span>
            <span class="s1">&#39;Si&#39;</span><span class="p">:</span> <span class="mf">28.085</span><span class="p">,</span>
            <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="mf">30.973761998</span><span class="p">,</span>
            <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mf">32.06</span><span class="p">,</span>
            <span class="s1">&#39;Cl&#39;</span><span class="p">:</span> <span class="mf">35.45</span><span class="p">,</span>
            <span class="s1">&#39;Ar&#39;</span><span class="p">:</span> <span class="mf">39.948</span><span class="p">,</span>
            <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mf">39.0983</span><span class="p">,</span>
            <span class="s1">&#39;Ca&#39;</span><span class="p">:</span> <span class="mf">40.078</span><span class="p">,</span>
            <span class="s1">&#39;Fe&#39;</span><span class="p">:</span> <span class="mf">55.845</span><span class="p">,</span>
            <span class="s1">&#39;Ti&#39;</span><span class="p">:</span> <span class="mf">47.867</span><span class="p">,</span>
            <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="mf">50.9415</span><span class="p">,</span>
        
            <span class="c1"># Molecules</span>
            <span class="s1">&#39;H2&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">1.00784</span><span class="p">,</span>
            <span class="s1">&#39;H2O&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">1.00784</span> <span class="o">+</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;OH&#39;</span><span class="p">:</span> <span class="mf">1.00784</span> <span class="o">+</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;O2&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;O3&#39;</span><span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;CO&#39;</span><span class="p">:</span> <span class="mf">12.0107</span> <span class="o">+</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;CO2&#39;</span><span class="p">:</span> <span class="mf">12.0107</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;CH4&#39;</span><span class="p">:</span> <span class="mf">12.0107</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">1.00784</span><span class="p">,</span>
            <span class="s1">&#39;C2H2&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">12.0107</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">1.00784</span><span class="p">,</span>
            <span class="s1">&#39;C2H4&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">12.0107</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">1.00784</span><span class="p">,</span>
            <span class="s1">&#39;C2H6&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">12.0107</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="mf">1.00784</span><span class="p">,</span>
            <span class="s1">&#39;NH3&#39;</span><span class="p">:</span> <span class="mf">14.0067</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="mf">1.00784</span><span class="p">,</span>
            <span class="s1">&#39;N2&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">14.0067</span><span class="p">,</span>
            <span class="s1">&#39;NO&#39;</span><span class="p">:</span> <span class="mf">14.0067</span> <span class="o">+</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;NO2&#39;</span><span class="p">:</span> <span class="mf">14.0067</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;HCN&#39;</span><span class="p">:</span> <span class="mf">1.00784</span> <span class="o">+</span> <span class="mf">12.0107</span> <span class="o">+</span> <span class="mf">14.0067</span><span class="p">,</span>
            <span class="s1">&#39;SiO&#39;</span><span class="p">:</span> <span class="mf">28.085</span> <span class="o">+</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;SO&#39;</span><span class="p">:</span> <span class="mf">32.06</span> <span class="o">+</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;SO2&#39;</span><span class="p">:</span> <span class="mf">32.06</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;H2S&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">1.00784</span> <span class="o">+</span> <span class="mf">32.06</span><span class="p">,</span>
            <span class="s1">&#39;PH3&#39;</span><span class="p">:</span> <span class="mf">30.973761998</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="mf">1.00784</span><span class="p">,</span>
            <span class="s1">&#39;CS&#39;</span><span class="p">:</span> <span class="mf">12.0107</span> <span class="o">+</span> <span class="mf">32.06</span><span class="p">,</span>
            <span class="s1">&#39;HCl&#39;</span><span class="p">:</span> <span class="mf">1.00784</span> <span class="o">+</span> <span class="mf">35.45</span><span class="p">,</span>
            <span class="s1">&#39;FeH&#39;</span><span class="p">:</span> <span class="mf">1.00784</span> <span class="o">+</span> <span class="mf">55.845</span><span class="p">,</span>
            <span class="s1">&#39;TiO&#39;</span><span class="p">:</span> <span class="mf">47.867</span> <span class="o">+</span> <span class="mf">15.999</span><span class="p">,</span>
            <span class="s1">&#39;VO&#39;</span><span class="p">:</span> <span class="mf">50.9415</span> <span class="o">+</span> <span class="mf">15.999</span>
        <span class="p">}</span>
        <span class="k">return</span></div>
</div>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Joshua D. Lothringer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>